# 2022

## ä¸‰æœˆ

### charAt ä¸ index çš„åŒºåˆ«

**ç›¸åŒç‚¹ï¼š**

å½“å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ª non-BMPï¼ˆ[Unicodeå­—ç¬¦å¹³é¢æ˜ å°„](https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%B9%B3%E9%9D%A2%E6%98%A0%E5%B0%84#.E5.9F.BA.E6.9C.AC.E5.A4.9A.E6.96.87.E7.A7.8D.E5.B9.B3.E9.9D.A2)ï¼‰ï¼Œéƒ½æ˜¯è¯†åˆ«å‡ºå¯¹åº”ä½ç½®çš„ç¼–ç ï¼Œè€Œå®é™…ä¸Š `\uD87E\uDC04` æ˜¯ä¸€ä¸ªå­—ã€‚å¦‚ä½•ä½¿å¾— charAt æ”¯æŒ non-BMP å­—ç¬¦å¯ä»¥å‚è€ƒ [MDN çš„æ–¹æ¡ˆ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt#fixing_charat_to_support_non-basic-multilingual-plane_bmp_characters)

```js
const str = 'A\uD87E\uDC04Z'

case: str.length // -> 4
case: str[1] === str.charAt(1) // true éƒ½æ˜¯ \uD87E
```

**ä¸åŒç‚¹ï¼š**



å‚è€ƒ [StackOverFlow: charAt æ‰§è¡Œè¿‡ç¨‹](https://stackoverflow.com/questions/9980608/why-javascripts-charat-with-a-string-returns-the-first-letter/9980660#9980660)ã€‚

charAt ä¼šå¤„ç†å…¥å‚ï¼Œå°†å‚æ•°è½¬ä¸ºæ•°å­—ï¼Œå‘ä¸‹èˆå…¥ï¼Œè¶…å‡ºå­—ç¬¦ä¸²èŒƒå›´èŒƒå›´ç©ºå­—ç¬¦ä¸²

```js
"Hello"[313]    //undefined
"Hello".charAt(313)    //"", 313 is out of bounds

"Hello"[3.14]    //undefined
"Hello".charAt(3.14)    //'l', rounds 3.14 down to 3

"Hello"[true]    //undefined
"Hello".charAt(true)    //'e', converts true to the integer 1

"Hello"["World"]    //undefined
"Hello".charAt("World")    //'H', "World" evaluates to NaN, which gets converted to 0

"Hello"[Infinity]    //undefined
"Hello".charAt(Infinity)    //"", Infinity is out of bounds
```





### __dirname in ES module 

[No `__filename` or `__dirname`](https://nodejs.org/api/esm.html#no-__filename-or-__dirname)

åœ¨ es æ¨¡å—ä¸­ï¼Œæ˜¯æ²¡æœ‰ __dirname çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ hack

```js
import { dirname } from 'path'
import { fileURLToPath } from 'url'

const __dirname = dirname(fileURLToPath(import.meta.url))
```



### compose ç»„åˆ

å‡½æ•°ç»„åˆï¼Œæ¥è‡ªäº Reduxï¼Œå¯ä»¥é€šè¿‡ compose å‡½æ•°ç»„åˆ middleware

```js
// compose(f, g, h) ç›¸å½“äº (...args) => f(g(h(...args)))
function compose(...funcs) {
  if (funcs.length === 0) {
    return (arg) => arg
  }

  if (funcs.length === 1) {
    return funcs[0]
  }

  return funcs.reduce((a, b) => (...args) => a(b(...args)))
}
```



## äºŒæœˆ

### æ ‡ç­¾æ¨¡ç‰ˆ

æœ€è¿‘çœ‹äº†ä¸‹ styled-componentsï¼Œå‘ç°ä»–å¾ˆå¥‡æ€ªçš„ä½¿ç”¨æ–¹å¼

```jsx
const Button = styles.a`
	width: 11rem;
	padding: 0.5rem 0;
`
```

ä»¥å‰ä¸€ç›´ä»¥ä¸ºæ˜¯ç¼–è¯‘æ—¶çš„ï¼Œè§‰å¾—è¿™ç§å†™æ³•ä¹Ÿå¤ªéš¾æäº†ï¼Œæœ€è¿‘åˆçœ‹äº†ä¸‹ï¼Œæ„è¯†åˆ°è¿™æ˜¯æ¨¡ç‰ˆå­—ç¬¦ä¸²çš„ä¸€ç§åŠŸèƒ½ï¼Œå«**æ ‡ç­¾æ¨¡ç‰ˆ**ã€‚ï¼ˆä»¥å‰å­¦ ES çš„æ—¶å€™å’‹æ²¡å‘ç° ğŸ˜‚ï¼‰

åˆçªç„¶æƒ³åˆ°ï¼Œgraphql ä¹Ÿæ˜¯ç”¨äº†æ ‡ç­¾æ¨¡æ¿çš„ï¼š

```js
const typeDefs = gql`
  type Query {
    hello: String
  }
`
```



ç”¨ä¾‹å‚è€ƒ [é˜®ä¸€å³°çš„ ESCMScript 6 å…¥é—¨ â€”â€” æ ‡ç­¾æ¨¡ç‰ˆ](https://es6.ruanyifeng.com/#docs/string#%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2)

```js
const tag = strArr => {
  console.log(strArr) // -> ['hello']
}
tag`hello`
```

å¦‚æœä½¿ç”¨åŠ¨æ€æ‹¼æ¥ï¼Œå°±ä¼šä¸å¤ªä¸€æ ·ï¼ŒåŠ¨æ€æ‹¼æ¥çš„ä¼šä½¿å¾—å­—ç¬¦ä¸²åˆ†å‰²ï¼Œå¹¶ä¸€ä¸ªä¸€ä¸ªçš„éƒ½æ”¾åœ¨ resetParams ä¸­ï¼š

```js
const tag = (strArr, ...resetParams) => {
  console.log(strArr) // ['start:', ' end then:', '']
  console.log(resetParams) // [10, 11]
}

const a = 10
tag`start:${a} end then:${a + 1} `
```

æœ‰å“ªäº›ç”¨å¤„å‘¢ï¼š

**å¯ä»¥å†™ä¸€ä¸ª jsx å‡½æ•°**

```js
const Page = ({ children, title, onClick }) => jsx`
  <div>
    <h1>${title}</h1>
    <button onClick={${onClick}>${children}</button>
  </div>
`
```

ç”šè‡³å¯ä»¥åœ¨ JS ä¸­å†™ javaã€‚ï¼ˆé‚£æ˜¯ä¸æ˜¯ç”šè‡³å¯ä»¥åœ¨ JS ä¸­å†™ c++ ğŸ¤£ï¼‰

```js
java`
class HelloWorldApp {
  public static void main(String[] args) {
    System.out.println("Hello World!");
  }
}
`
HelloWorldApp.main()
```

### `(0, foo)()`

é€—å·æ“ä½œç¬¦ï¼šä»å·¦å¾€å³æ±‚å€¼ï¼Œå¹¶è¿”å›æœ€åä¸€ä¸ªå€¼

`(0, foo)` ç›¸å½“äº `const bar = foo`ã€‚



ä¼¼ä¹è·Ÿç›´æ¥ç”¨ foo è°ƒç”¨æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå°±å¯ä»¥çœ‹å‡ºæ¥ä¸ä¸€æ ·ã€‚

```js
const obj = {
  a: 1,
  foo: function () {
    return this.a
  }
}
window.a = 2
obj.foo() // -> 1
(0, obj.foo)() // -> 2ï¼Œæ­¤æ—¶çš„ this æŒ‡å‘çš„æ˜¯ window
```

å› ä¸º `(0, obj.foo)()` ç›¸å½“äº `const bar = obj.foo; bar()`ï¼Œæ”¹å˜äº† foo çš„è¿è¡Œç¯å¢ƒï¼Œæ‰€ä»¥ this æŒ‡å‘ window äº†ã€‚



### é—­åŒ…çš„å¦ä¸€ç§æ€è€ƒ

ä¸€ä¸ªå‡½æ•°å’Œå¯¹å…¶å‘¨å›´çŠ¶æ€ï¼ˆ**lexical environmentï¼Œè¯æ³•ç¯å¢ƒ**ï¼‰çš„å¼•ç”¨æ†ç»‘åœ¨ä¸€èµ·ï¼ˆæˆ–è€…è¯´å‡½æ•°è¢«å¼•ç”¨åŒ…å›´ï¼‰ï¼Œè¿™æ ·çš„ç»„åˆå°±æ˜¯**é—­åŒ…**ï¼ˆ**closure**ï¼‰â€”â€” [é—­åŒ… - MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures)

æœ€è¿‘åœ¨çœ‹ ã€ŠJavaScript è®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µã€‹ä¸­æåˆ°ä¸€ç‚¹ä¹Ÿå¾ˆæœ‰æ„æ€ï¼š

> å¯¹è±¡ä»¥æ–¹æ³•çš„å½¢å¼åŒ…å«äº†è¿‡ç¨‹ï¼Œè€Œé—­åŒ…åˆ™æ˜¯åœ¨è¿‡ç¨‹ä¸­ä»¥ç¯å¢ƒçš„å½¢å¼åŒ…å«äº†æ•°æ®ã€‚

PSï¼šä¸è¿‡æˆ‘è§‰å¾—è¿™ä¸ªæè¿°æœ‰ç‚¹å¥‡æ€ªï¼Œå¦å¤–ä¸€ç‚¹ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼ˆä¹Ÿä¸å‡†ç¡®ï¼‰ï¼Œå¯¹è±¡å†™æ³•çš„æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº† `this.count` ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å…¶å‘¨å›´çŠ¶æ€ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ç§é—­åŒ…æŠ€æœ¯å—ï¼Ÿ

**é—­åŒ…å†™æ³•**

é€šè¿‡ chrome è°ƒè¯•å¯ä»¥å‘ç°ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå« `Closure(foo)` çš„ Scopeï¼Œå†…éƒ¨æ˜¯ `{ count: 0 }`

```js
function foo () {
  let count = 0
  return {
    increase: () => {
      count++
      return count
    }
  }
}
const counter = foo()
counter.increase() // -> 1
counter.increase() // -> 2
```

**å¯¹è±¡å†™æ³•**

é€šè¿‡ chrome è°ƒè¯•å¯ä»¥å‘ç°ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå« `Closure(./src/index.js)` çš„ Scopeï¼Œå†…éƒ¨æ˜¯ `{ count: 0, increase: increase() }`

```js
const counter = {
  count: 0,
  increase: function () {
    this.count++
    return this.count
  }
}
counter.increase() // -> 1
counter.increase() // -> 2
```

## ä¸€æœˆ

### TS çš„å¼‚å¸¸æ•è·

å› ä¸ºåœ¨ js ä¸­ï¼Œä»»ä½•å¼‚å¸¸éƒ½æœ‰å¯èƒ½è¢«æŠ›å‡º

```ts
throw "What a weird error";
throw 404;
throw new Error("What a weird error");
```

æ‰€ä»¥å½“ä½  `catch(e: TypeError)` ç±»ä¼¼è¿™æ ·çš„æ—¶å€™ ts ä¼šæŠ¥ **TS1196** Catch clause variable type annotation must be â€˜anyâ€™ or â€˜unknownâ€™ if specified.

è€ƒè™‘ä¸‹é¢çš„æ–¹å¼å†™ï¼š

```ts
try {
  myroutine(); // There's a couple of errors thrown here
} catch (e) {
  if (e instanceof TypeError) {
    // A TypeError
  } else if (e instanceof RangeError) {
    // Handle the RangeError
  } else if (e instanceof EvalError) {
    // you guessed it: EvalError
  } else if (typeof e === "string") {
    // The error is a string
  } else if (axios.isAxiosError(e)) {
    // axios does an error check for us!
  } else {
    // everything else  
    logMyErrors(e);
  }
}
```

Promise ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œ`reject` å…è®¸ä½ ä¼ å…¥ä»»ä½•ç±»å‹ã€‚

### IOS æ»šåŠ¨ç©¿é€é—®é¢˜

å¾ˆæ—©ä¹‹å‰å°±é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæ˜æ˜æ•´ä¸ªé¡µé¢éƒ½ `overflow:hidden` äº†ï¼Œä½†æ˜¯å½“ ios è™šæ‹Ÿé”®ç›˜å”¤èµ·æ—¶ï¼Œæ•´ä¸ªé¡µé¢ç¡®åˆå¯ä»¥æ»‘åŠ¨äº†ã€‚

å¯ä»¥é€šè¿‡é˜»æ­¢ `touchemove` äº‹ä»¶æ¥é¿å…ã€‚

```jsx
const handler = e => e.preventDefault()

<input
  onFocus={() => {
    document.body.addEventListener('touchmove', handler, { passive: false })
  }}
  onBlur={() => {
    document.body.removeEventListener('touchmove', handler, { passive: false })
  }}
/>
```

`e.preventDefault()` é˜»æ­¢é»˜è®¤äº‹ä»¶ã€‚

`passive`  ä¸º true æ—¶ï¼Œ listener å°†æ°¸è¿œä¸ä¼šè°ƒç”¨ `preventDefault()`ï¼ˆå³ä¸º true æ—¶ï¼Œæ˜¯æ— æ³•é˜»æ­¢é»˜è®¤äº‹ä»¶çš„æ‰‹åŠ¨è°ƒç”¨äº† `preventDefault` ä¹Ÿä¸ä¼šæœ‰æ•ˆæœï¼Œæ§åˆ¶å°ä¼šè­¦å‘Šï¼‰ã€‚

æ ¹æ®è§„èŒƒ `passive` å±æ€§é»˜è®¤ä¸º falseï¼ˆå…è®¸é˜»æ­¢ï¼‰ã€‚ä½†æ˜¯åœ¨å¤„ç†æŸäº›è§¦æ‘¸äº‹ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé˜»æ­¢æµè§ˆå™¨çš„ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ»šåŠ¨å¤„ç†çš„æ€§èƒ½é™ä½ï¼Œæ‰€ä»¥æœ‰äº›æµè§ˆå™¨å°†æ–‡æ¡£çº§èŠ‚ç‚¹ `Window` `Document` `Document.body` çš„ touchStart touchMove äº‹ä»¶çš„ passive é»˜è®¤å€¼æ”¹ä¸º trueã€‚
